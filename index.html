<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Universal Evolution: Responsive Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <style>
        :root[data-theme="dark"] {
            --atp-color: #00ff88; --atp-glow: rgba(0, 255, 136, 0.4);
            --dna-color: #bc13fe; --dna-glow: rgba(188, 19, 254, 0.4);
            --danger-color: #ff3860; --bg-color: #050508;
            --panel-bg: rgba(15, 15, 25, 0.96);
            --panel-border: 1px solid rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff; --text-secondary: #8899aa;
            --combo-low: #00ff88; --combo-mid: #f1c40f; --combo-high: #ff3860;
            --path-pred: #ff3860; --path-soc: #00d1ff;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Roboto', sans-serif; 
            background: var(--bg-color); 
            color: var(--text-primary); 
            margin: 0; 
            min-height: 100vh;
            display: flex;
            justify-content: center;
            overflow-x: hidden;
        }

        /* --- MOBILE-FIRST CENTERING LOGIC --- */
        #game-wrapper { 
            display: flex;
            flex-direction: column; /* Stack vertically by default */
            align-items: center;
            width: 100%;
            max-width: 1400px;
            padding: 20px;
            padding-top: 100px;
            gap: 30px;
        }

        /* Desktop: Three Column Layout */
        @media (min-width: 1200px) {
            #game-wrapper {
                flex-direction: row; /* Side by side */
                align-items: flex-start;
                justify-content: center;
                height: 100vh;
                overflow: hidden;
            }
            .panel { height: 75vh; width: 350px; flex-shrink: 0; }
            .main-display { flex: 1; max-width: 600px; }
        }

        /* Tablet/Large Phone: Two Columns */
        @media (min-width: 768px) and (max-width: 1199px) {
            #game-wrapper {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }
            .main-display { width: 100%; order: -1; margin-bottom: 20px; }
            .panel { width: 45%; min-width: 320px; }
        }

        .panel { 
            background: var(--panel-bg); 
            border-radius: 20px; 
            border: var(--panel-border); 
            padding: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            transition: opacity 0.5s;
        }

        .main-display { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            width: 100%; 
        }

        /* ANTI-SHAKE HUD */
        .resource-hud { 
            background: var(--panel-bg); 
            padding: 15px 25px; 
            border-radius: 25px; 
            border: var(--panel-border); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: 15px; 
            width: 100%;
            max-width: 500px;
        }
        .res-box { width: 40%; text-align: center; }
        .res-val { font-family: 'Orbitron'; font-weight: 700; font-size: 1.4em; white-space: nowrap; }

        #transmute-btn { 
            width: 40px; height: 40px; border-radius: 50%; border: 1px solid var(--dna-color); 
            background: rgba(188, 19, 254, 0.1); color: var(--dna-color); font-size: 1.1em;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
        }

        /* SPECIMEN SIZE SCALING */
        #specimen-container { 
            position: relative; 
            width: 220px; height: 220px; 
            margin: 40px 0; 
            display: flex; justify-content: center; align-items: center; 
            border-radius: 50%; border: 2px solid var(--atp-color); 
            box-shadow: 0 0 30px var(--atp-glow);
        }
        @media (min-width: 1200px) { #specimen-container { width: 280px; height: 280px; } }

        #specimen { font-size: 80px; cursor: pointer; user-select: none; z-index: 6; }
        #specimen.singularity { font-size: 25px; }

        .top-bar { position: fixed; top:0; left:0; width:100%; height:70px; background: var(--panel-bg); display: flex; justify-content: space-between; align-items: center; padding: 0 20px; border-bottom: var(--panel-border); z-index: 1000; }
        
        .upgrade-card { background: rgba(255,255,255,0.03); padding: 12px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--atp-color); }
        .reveal-target { transition: opacity 0.8s ease; }
        .hidden-panel { display: none !important; }
        
        .ripple { position: absolute; border: 2px solid var(--atp-color); border-radius: 50%; pointer-events: none; animation: ripple 0.5s forwards; }
        @keyframes ripple { from { width: 0; height: 0; opacity: 1; } to { width: 250px; height: 250px; opacity: 0; } }

        #progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--atp-color), var(--dna-color)); transition: 0.3s; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9000; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div class="top-bar reveal-target">
    <div style="font-family:'Orbitron'; font-size:0.7em;">UNI: <span id="uni-val" style="color:gold">1</span> | ERA: <span id="era-val">VOID</span></div>
    <div style="display:flex; gap:10px;">
        <button onclick="toggleMute()" id="mute-btn" style="background:none; border:none; color:white;">üîä</button>
        <button onclick="toggleModal('archive-modal')" style="background:none; border:1px solid white; border-radius:5px; color:white; font-size:0.6em; padding:5px;">ARC</button>
    </div>
</div>

<div id="game-wrapper">
    <div class="panel reveal-target" id="phys-panel">
        <div class="panel-header">Physical Growth</div>
        <div id="phys-upgrades" style="overflow-y:auto;"></div>
    </div>
    
    <div class="main-display">
        <div class="resource-hud reveal-target">
            <div class="res-box">
                <div class="res-val" id="atp-display" style="color:var(--atp-color)">0</div>
                <div style="font-size:0.5em; font-family:'Orbitron';">POTENTIAL</div>
            </div>
            <button id="transmute-btn" onclick="transmute()">‚áÑ</button>
            <div class="res-box">
                <div class="res-val" id="dna-display" style="color:var(--dna-color)">0</div>
                <div style="font-size:0.5em; font-family:'Orbitron';">STRUCTURE</div>
            </div>
        </div>

        <div id="specimen-container">
            <div id="specimen" class="singularity" onclick="handleClick()">‚óè</div>
        </div>

        <div style="text-align:center; width: 100%; max-width: 400px;">
            <h2 id="stage-name" class="reveal-target" style="font-family:'Orbitron'; margin:0; font-size:1.1em;">Singularity</h2>
            <div style="height:6px; background:rgba(255,255,255,0.1); border-radius:3px; margin:10px 0;"><div id="progress-fill"></div></div>
            <div id="progress-stats" class="reveal-target" style="font-family:'Orbitron'; font-size:0.6em; opacity:0.6;">0 / 500</div>
        </div>
    </div>

    <div class="panel reveal-target hidden-panel" id="dna-panel">
        <div class="panel-header" style="color:var(--dna-color)">Research</div>
        <div id="dna-upgrades" style="overflow-y:auto;"></div>
    </div>
</div>

<div id="path-modal" class="modal"><div class="panel" style="width:300px; text-align:center;"><h2>CHOOSE PATH</h2><button onclick="selectPath('predatory')" style="background:var(--path-pred); margin-bottom:10px;">HUNTER</button><button onclick="selectPath('social')" style="background:var(--path-soc);">HIVE MIND</button></div></div>
<div id="archive-modal" class="modal"><div class="panel"><h2>ARCHIVE</h2><button onclick="toggleModal('archive-modal')">CLOSE</button></div></div>

<script>
    const STORAGE_KEY = 'evo_mobile_v1';
    const INITIAL = {
        uni: 1, atp: 0, dna: 0, total: 0, stage: 0, atpRate: 0, dnaRate: 0, multi: 1, click: 1, path: null, muted: false,
        upgrades: {
            phys: [
                { id: 'p1', name: "Gravity", cost: 10, addClick: 1, count: 0, era: 0 },
                { id: 'p2', name: "Spark", cost: 100, r: 5, count: 0, era: 1 }
            ],
            dna: [
                { id: 'd1', name: "Nodes", cost: 100000, r: 100, count: 0, era: 4, cur: 'atp' },
                { id: 'd2', name: "Sync", cost: 1000, m: 2.0, count: 0, era: 5, cur: 'dna' }
            ]
        }
    };

    const stages = [{ name: "Singularity", emo: "‚óè", goal: 500 }, { name: "Subatomic", emo: "üîò", goal: 5000 }, { name: "Atom", emo: "‚öõÔ∏è", goal: 50000 }, { name: "Molecule", emo: "üß™", goal: 500000 }, { name: "Organic", emo: "üíé", goal: 5000000 }];

    let state = JSON.parse(localStorage.getItem(STORAGE_KEY)) || JSON.parse(JSON.stringify(INITIAL));

    function handleClick() {
        const gain = state.click * state.multi * Math.pow(2, state.uni-1);
        state.atp += gain; state.total += gain;
        const r = document.createElement('div'); r.className='ripple';
        if(state.path) r.style.borderColor = `var(--path-${state.path})`;
        document.getElementById('specimen-container').appendChild(r);
        setTimeout(() => r.remove(), 500);
        updateUI();
    }

    function transmute() {
        if (state.atp >= 100000) {
            const amt = state.atp * 0.2;
            state.atp -= amt; state.dna += (amt / 500); updateUI();
        }
    }

    function buy(type, i) {
        const u = state.upgrades[type][i];
        const cur = u.cur || 'atp';
        if (state[cur] >= u.cost) {
            state[cur] -= u.cost; u.count++;
            if (u.r) type === 'phys' ? state.atpRate += u.r : state.dnaRate += u.r;
            if (u.m) state.multi += u.m;
            if (u.addClick) state.click += u.addClick;
            u.cost = Math.floor(u.cost * 1.6); renderUpgrades(); updateUI();
        }
    }

    function updateUI() {
        document.getElementById('atp-display').innerText = formatNum(state.atp);
        document.getElementById('dna-display').innerText = formatNum(state.dna);
        document.getElementById('uni-val').innerText = state.uni;

        const s = stages[state.stage];
        document.getElementById('specimen').innerText = s.emo;
        document.getElementById('stage-name').innerText = s.name;
        
        const prev = state.stage > 0 ? stages[state.stage-1].goal : 0;
        document.getElementById('progress-fill').style.width = Math.min(((state.total - prev) / (s.goal - prev)) * 100, 100) + "%";
        document.getElementById('progress-stats').innerText = `${formatNum(state.total - prev)} / ${formatNum(s.goal - prev)}`;

        let op = state.stage > 0 ? 1 : Math.max(0.1, state.total / 500);
        document.querySelectorAll('.reveal-target').forEach(el => { el.style.opacity = op; el.style.pointerEvents = op < 0.2 ? 'none' : 'auto'; });

        document.getElementById('transmute-btn').style.visibility = state.stage >= 3 ? 'visible' : 'hidden';
        if (state.stage >= 4) document.getElementById('dna-panel').classList.remove('hidden-panel');
        if (state.path) document.getElementById('specimen-container').style.borderColor = `var(--path-${state.path})`;

        if (state.total >= s.goal && state.stage < stages.length - 1) {
            state.stage++; if(state.stage === 4 && !state.path) toggleModal('path-modal');
            renderUpgrades();
        }
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function formatNum(n) {
        if(n < 1000) return Math.floor(n);
        const units = ["K", "M", "B", "T"];
        const e = Math.floor(Math.log10(n) / 3);
        return (n / Math.pow(10, e * 3)).toFixed(1) + units[e-1];
    }

    function renderUpgrades() {
        ['phys', 'dna'].forEach(type => {
            document.getElementById(`${type}-upgrades`).innerHTML = state.upgrades[type].filter(u => state.stage >= u.era).map((u, i) => `
                <div class="upgrade-card">
                    <div style="font-size:0.7em;"><b>${u.name}</b><br>Lvl ${u.count}</div>
                    <button onclick="buy('${type}', ${i})" style="font-size:0.7em; padding:5px 10px;">${formatNum(u.cost)}</button>
                </div>
            `).join('');
        });
    }

    function toggleModal(id) { document.getElementById(id).style.display = document.getElementById(id).style.display === 'flex' ? 'none' : 'flex'; }
    function selectPath(p) { state.path = p; toggleModal('path-modal'); updateUI(); }
    function toggleMute() { state.muted = !state.muted; document.getElementById('mute-btn').innerText = state.muted ? "üîá" : "üîä"; }

    setInterval(() => {
        const b = Math.pow(2, state.uni-1);
        state.atp += (state.atpRate * state.multi * b) / 10;
        state.dna += (state.dnaRate * b) / 10;
        state.total += (state.atpRate * state.multi * b) / 10;
        updateUI();
    }, 100);

    renderUpgrades(); updateUI();
</script>
</body>
</html>
